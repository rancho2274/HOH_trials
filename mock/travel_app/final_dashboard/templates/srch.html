
{% extends "base.html" %}
{% block content %}
<div class="header">
  <h2>Live API Health: Search</h2>
  <button class="refresh-btn" onclick="refreshDashboard()">
    <i class="fas fa-sync-alt"></i> Refresh
  </button>
</div>

<div class="cards">
  <div class="card">
    <h4>Total Logs</h4>
    <h3 id="total-apis">{{ api_stats.search.total_logs }}</h3>
    <small id="total-apis-note" class="green">+{{ (api_stats.search.total_logs // 5)|default(0) }} this month</small>
  </div>
  <div class="card">
    <h4>Active Issues</h4>
    <h3 id="active-issues">{{ api_stats.search.anomalies }}</h3>
    <small id="active-issues-note" class="red">+{{ api_stats.search.anomalies }} from yesterday</small>
  </div>
  <div class="card">
    <h4>Average Response</h4>
    <h3 id="avg-response">{{ api_stats.search.anomalous_avg|default(0)|round(2) }}ms</h3>
    <small id="avg-response-note" class="{% if api_stats.search.anomalous_avg < 300 %}green{% else %}red{% endif %}">{{ (api_stats.search.anomalous_avg * 0.1)|default(0)|round(1) }}ms {% if api_stats.search.anomalous_avg < 300 %}improvement{% else %}slower{% endif %}</small>
  </div>
  <div class="card">
    <h4>API Health</h4>
    <h3 id="system-health">{{ (100 - (api_stats.search.anomaly_percent|default(0)))|round(1) }}%</h3>
    <small id="system-health-note" class="{% if api_stats.search.anomaly_percent > 0 %}red{% else %}green{% endif %}">{% if api_stats.search.anomaly_percent > 0 %}-{% else %}+{% endif %}{{ [api_stats.search.anomaly_percent|default(0), 10]|min }}% this week</small>
  </div>
</div>

<div style="margin-top: 40px;">
  <h4 style="margin-bottom: 10px;">Search API - Performance Metrics</h4>
  
  <div class="statuses">
    <div class="status">
      <h4>Search Operations</h4>
      <div class="status-item">
        <span>Location Search</span>
        <span class="{% if api_stats.search.anomalies > 0 %}status-red{% else %}status-green{% endif %}">
          {{ api_stats.search.anomalous_avg|default(165, true) }}ms
        </span>
      </div>
      <div class="status-item">
        <span>Hotel Search</span>
        <span class="{% if api_stats.search.anomalies > 0 %}status-yellow{% else %}status-green{% endif %}">
          {{ (api_stats.search.anomalous_avg * 1.2)|default(198, true)|round }}ms
        </span>
      </div>
      <div class="status-item">
        <span>Destination Info</span>
        <span class="status-green">
          {{ (api_stats.search.normal_avg * 0.8)|default(110, true)|round }}ms
        </span>
      </div>
    </div>
    
    <div class="alert">
      <h4>Search API Alerts</h4>
      {% if api_stats.search.anomalies > 0 %}
        <div class="alert-item">
          <div>
            <div class="severity-high">High Severity</div>
            <p>Search API Response Time Spike: {{ api_stats.search.anomalous_avg }}ms</p>
            <small>5 minutes ago</small>
          </div>
        </div>
        <div class="alert-item">
          <div>
            <div class="severity-medium">Medium Severity</div>
            <p>Increased latency for location searches</p>
            <small>15 minutes ago</small>
          </div>
        </div>
      {% else %}
        <div class="alert-item">
          <div>
            <div class="severity-medium">Medium Severity</div>
            <p>No critical issues detected</p>
            <small>Just now</small>
          </div>
        </div>
        <div class="alert-item">
          <div>
            <div class="severity-medium">Medium Severity</div>
            <p>Search service operating normally</p>
            <small>5 minutes ago</small>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  function refreshDashboard() {
    window.location.reload();
  }
</script>
{% endblock %}