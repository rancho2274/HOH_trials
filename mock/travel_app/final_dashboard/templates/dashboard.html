{% extends "base.html" %}
{% block content %}
<div class="header">
  <h2>Dashboard</h2>
  <button class="refresh-btn" onclick="refreshDashboard()">
    <i class="fas fa-sync-alt"></i> Refresh
  </button>
</div>

<div class="cards">
  <div class="card">
    <h4>Total APIs</h4>
    <h3 id="total-apis">0</h3>
    <small id="total-apis-note" class="green">+0 this month</small>
  </div>
  <div class="card">
    <h4>Active Issues</h4>
    <h3 id="active-issues">0</h3>
    <small id="active-issues-note" class="red">+0 from yesterday</small>
  </div>
  <div class="card">
    <h4>Average Response</h4>
    <h3 id="avg-response">0ms</h3>
    <small id="avg-response-note" class="green">0ms improvement</small>
  </div>
  <div class="card">
    <h4>System Health</h4>
    <h3 id="system-health">0%</h3>
    <small id="system-health-note" class="red">0% this week</small>
  </div>
</div>

<div class="statuses">
  <div class="status">
    <h4>Real-time API Status</h4>
    <div class="status-item"><span>Authentication API</span><span id="auth-status" class="status-green">0ms</span></div>
    <div class="status-item"><span>Payment Gateway</span><span id="payment-status" class="status-yellow">0ms</span></div>
    <div class="status-item"><span>User Service</span><span id="user-status" class="status-green">0ms</span></div>
    <div class="status-item"><span>Order Processing</span><span id="order-status" class="status-red">0ms</span></div>
  </div>
  <div class="alert">
    <h4>Critical Alerts</h4>
    <div class="alert-item">
      <div>
        <div class="severity-high">High Severity</div>
        <p id="alert-1">No alerts yet</p>
        <small id="alert-1-time">--</small>
      </div>
    </div>
    <div class="alert-item">
      <div>
        <div class="severity-medium">Medium Severity</div>
        <p id="alert-2">--</p>
        <small id="alert-2-time">--</small>
      </div>
    </div>
  </div>
</div>

<script>
  function refreshDashboard() {
    fetch('/api/dashboard-data')
      .then(res => res.json())
      .then(data => {
        document.getElementById('total-apis').textContent = data.total_apis;
        document.getElementById('total-apis-note').textContent = data.total_apis_note;
        document.getElementById('active-issues').textContent = data.active_issues;
        document.getElementById('active-issues-note').textContent = data.active_issues_note;
        document.getElementById('avg-response').textContent = data.avg_response + 'ms';
        document.getElementById('avg-response-note').textContent = data.avg_response_note;
        document.getElementById('system-health').textContent = data.system_health + '%';
        document.getElementById('system-health-note').textContent = data.system_health_note;

        document.getElementById('auth-status').textContent = data.auth_status + 'ms';
        document.getElementById('payment-status').textContent = data.payment_status + 'ms';
        document.getElementById('user-status').textContent = data.user_status + 'ms';
        document.getElementById('order-status').textContent = data.order_status + 'ms';

        document.getElementById('alert-1').textContent = data.alerts[0].message;
        document.getElementById('alert-1-time').textContent = data.alerts[0].time;
        document.getElementById('alert-2').textContent = data.alerts[1].message;
        document.getElementById('alert-2-time').textContent = data.alerts[1].time;
      });
  }

  // Initial fetch
  refreshDashboard();
</script>
{% endblock %}
