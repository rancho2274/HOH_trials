{% extends "base.html" %}
{% block content %}
<div class="header">
  <h2>Live API Health: Feedback</h2>
  <button class="refresh-btn" onclick="refreshDashboard()">
    <i class="fas fa-sync-alt"></i> Refresh
  </button>
</div>

<div class="cards">
  <div class="card">
    <h4>Total Logs</h4>
    <h3 id="total-logs">0</h3>
    <small id="total-logs-note" class="green">+0 this month</small>
  </div>
  <div class="card">
    <h4>Active Issues</h4>
    <h3 id="active-issues">0</h3>
    <small id="active-issues-note" class="red">+0 from yesterday</small>
  </div>
  <div class="card">
    <h4>Average Response</h4>
    <h3 id="avg-response">0ms</h3>
    <small id="avg-response-note" class="green">0ms improvement</small>
  </div>
  <div class="card">
    <h4>System Health</h4>
    <h3 id="system-health">100%</h3>
    <small id="system-health-note" class="green">+0% this week</small>
  </div>
</div>

<script>
  function refreshDashboard() {
    fetch('/refresh')
      .then(res => res.json())
      .then(data => {
        // Get feedback API specific stats
        const feedbackStats = data.api_stats.feedback;
        
        // Update the dashboard metrics
        document.getElementById('total-logs').textContent = feedbackStats.total_logs || 0;
        document.getElementById('active-issues').textContent = feedbackStats.anomalies || 0;
        document.getElementById('avg-response').textContent = (feedbackStats.normal_avg || 0) + 'ms';
        document.getElementById('system-health').textContent = feedbackStats.anomaly_percent 
          ? (100 - feedbackStats.anomaly_percent) + '%' 
          : '100%';
      })
      .catch(err => {
        console.error("Error refreshing dashboard:", err);
      });
  }

  // Initial refresh on page load
  document.addEventListener('DOMContentLoaded', refreshDashboard);
</script>
{% endblock %}